{% import "stream_options_macro.html" as stream_options %}

{% extends "layout.html" %}
{% block title %}Stream: {{ var }}{% endblock %}

{% block body %}
{{ super() }}
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/bootstrap-only-glyphicons.css') }}" media="screen">
<div class="container">
    
    {% for ID in IDs %}
        <!-- Plot and Options -->
        <div class="row">
            <!-- Plot -->
            <div class="col-md-8">
                <!-- plotly div -->
                <div style="padding:0" id='ID'></div>
            </div>
            
            <!-- Options -->
            <div class="col-md-4 vcenter">
                <div class="card hcenter">
                    <div class="card-header">Display Options</div>
                    <div class="card-body">
                        <form class="form" role="form">
                            {{ stream_options.height_option([25, 40, 60, 80, 100], 25, "form-height") }}
                            {{ stream_options.threshold_option("form-range-lo", "form-range-hi") }}
                            {{ stream_options.time_range("start", "end", "toggle") }}
                            {{ stream_options.download("download") }}
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Horizontal Break -->
        <hr>
    {% endfor %}

</div>
{% endblock %}

{% block script %}
<script defer type="module">
    import * as module from "{{ url_for('static', filename='js/minargon/timeseries.js') }}";
    
    var IDs_ ={{IDs| tojson}};

    // for (var ID in IDs_) {

    // build the link
    var link = new module.Data.D3DataLink(new module.DataLink.PostgresStreamLink($SCRIPT_ROOT, "{{ database }}", '47'));

    // build plotly controller
    var plotly_controller = new module.PlotlyController('47', link, ["{{ configs['yTitle'] }}"], {{ configs| tojson}})
        .timeRangeController("#start", "#end", "#toggle")
        .downloadDataController("#download")

    // start it
    plotly_controller.run();
    // }

    // build the link
    var link2 = new module.Data.D3DataLink(new module.DataLink.PostgresStreamLink($SCRIPT_ROOT, "{{ database }}", '44'));

    // build plotly controller
    var plotly_controller2 = new module.PlotlyController('44', link2, ["{{ configs['yTitle'] }}"], {{ configs| tojson}})
        .timeRangeController("#start", "#end", "#toggle")
        .downloadDataController("#download")

    // start it
    plotly_controller2.run();

</script>
{% endblock %}