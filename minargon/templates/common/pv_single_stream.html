{% import "stream_options_macro.html" | common as stream_options %}
{% extends "common/view_streams.html" %}
{% block title %}Stream: {{ID}}{% endblock %}
{% block display_form %}
                    {{ stream_options.height_option([25, 40, 60, 80, 100], 25, "form-height") }}
                    {{ stream_options.threshold_option("form-range-lo", "form-range-hi",low,high) }}
                    {{ stream_options.time_range("start", "end", "toggle",start_time,end_time) }}
                    {{ stream_options.download("download") }}
{%endblock%}
{% block script %}
<script defer type="module">
import * as module from "{{ url_for('static', filename='js/minargon/timeseries.js') }}";
// build the link
var link = new module.Data.D3DataLink(new module.DataLink.EpicsStreamLink($SCRIPT_ROOT, "{{database}}", "{{ID}}"));

// build cubism controller
var controller = new module.CubismController("#cubism-timeseries", link, ["{{config['yTitle']}}"], {{config|tojson}}, 25)
  .heightController("#form-height")
  .rangeController("#form-range-lo", "#form-range-hi");

// start cubism
// controller.run();

// build plotly controller
var plotly_controller = new module.PlotlyController("plotly-timeseries", link, ["{{config['yTitle']}}"], {{config|tojson}})
  .timeRangeController("#start", "#end", "#toggle")
  .downloadDataController("#download")
  //.getData(0, 3600000);//"{{start_timestamp_int}}","{{end_timestamp_int}}")
  //.updateParam("{{low}}", "{{high}}")

// start it
//if user does supply start/end time call getData
//plotly_controller.getData(877189500,1034951400);
//updateParam thresholds

//plotly_controller.getData({{start_timestamp_int}}, {{end_timestamp_int}});

plotly_controller.run();


</script>
{% endblock %}
