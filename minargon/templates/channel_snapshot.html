{% extends "layout.html" %}
{% import "stream_options_macro.html" as stream_options %}

{% block title %}Channel Snapshot{% endblock %}
{% block body %}
{{ super() }}
<div class="container">
<div class="row">
    {% include 'data_header.html' %}
</div>
<div class="row">
    <div class="col-md-4">
        <div class="card hcenter">
            <div class="card-header">Display Options</div>
            <div class="card-body">
                <form class="form" role="form">
		    {{ stream_options.stream_option(streams, streams[0], "form-stream") }} 
                    {{ stream_options.height_option([40, 60, 80, 100], 40, "form-height") }}
	        </form>
            </div>
        </div>
    </div><!--
    --><div class="col-md-8" style="padding:0" id="timeseries"></div>
</div>
    <div class="row">
    <div class="col-md-12" style="padding:0" id="waveform-holder">
        <div id="waveform"></div>
    </div>
    </div>
    <div class="row">
    <div class="col-md-12" style="padding:0" id="FFT-holder">
        <div id="fft"></div>
    </div>
    </div>
</div>
{%endblock%}
{% block script %}
<script src="{{ url_for('static', filename='js/minargon/draw_waveform.js') }}" defer></script>
<script defer>
// get snapshot time
d3.json($SCRIPT_ROOT + "/online/snapshot/time", function(err, data) {
  var time = moment(new Date(data.value * 1000));
  $("#update-time").html("Snapshot At: " + time.format("MM/DD HH:mm:ss"));
});

d3.json($SCRIPT_ROOT + "/online/snapshot/sub_run", function(err, data) {
  $("#update-subrun").html("SubRun: "  + data.value);
});

$(document).ready(function() {
  // draw waveform
  draw_waveform('waveform', {wire: {{channel}} });
  draw_fft('fft', {wire: {{channel}} });
  
  // setup cubism
  var controller = new CubismMultiMetricController("#timeseries", {{timeseries.to_json()|safe}}, 0, {{stream_links|tojson|safe}}, {{streams|tojson|safe}}, 0, 40)
    .heightController("#form-height")
    .streamController("#form-stream"); 

  // start polling for data
  controller.run();
});
</script> 
{% endblock %}
